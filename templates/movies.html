{% extends "layout.html" %} {% block content %}

<!-- MOVIE SEARCH -->

    <form class="form-inline search">
      <label>Search Movies</label>
      <input
        type="text"
        class="form-control movie-input"
        name="q"
        placeholder="search movies"
      />
      <input
        type="hidden"
        name="api_key"
        value="bcd90145aa0a9afa766db2577135dbf4"
      />
      <input type="submit" value="Go!" class="btn btn-primary" />
    </form>
  
  
  <section id="search" class="py-5">
    <div class="container-fluid">
        <div class='row'>
          <div class="card movie-gallery" style="width: 15rem;"
          ></div>
            <div class="image-wrapper"></div>
      </div>
    </div>
  </section>




<!-- END SEARCH -->


<!-- PAGE HEADER -->
<header id="page-header">
  <div class="container">
    <div class="row">
      <div class="col-md-6 m-auto text-center">
        <h1>Movies</h1>
        <p>Check out our movies</p>
      </div>
    </div>
  </div>
</header>


<!-- START MOVIE GALLERY-->

<section id="gallery" class="py-5">
  <div class="container-fluid">
    <div class="row">
      <div class='row'>
        <div class="card now-playing" style="width: 15rem;">
        </div>
      </div>
    </div>
  </div>
</section>

<!-- <div class="row mb-4">
      <div class="col-sm-2 upcoming"></div>
    </div>
    <div class="row mb-4">
      <div class="col-sm-2 popular"></div>
    </div>
    <div class="row mb-4">
      <div class="col-sm-2 top-rated"></div>
    </div>
 -->

<!-- NEWSLETTER -->
<section id="newsletter" class="text-center p-5 bg-dark text-white">
  <div class="container">
    <div class="row">
      <div class="col">
        <h1>Sign Up For Our Newsletter</h1>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio
          asperiores consectetur, quae ducimus voluptates vero repellendus
          architecto maiores recusandae mollitia?
        </p>
        <form class="form-inline justify-content-center">
          <input
            type="text"
            class="form-control mb-2 mr-2"
            placeholder="Enter Name"
          />
          <input
            type="text"
            class="form-control mb-2 mr-2"
            placeholder="Enter Email"
          />
          <button class="btn btn-primary mb-2">Submit</button>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  let key = `bcd90145aa0a9afa766db2577135dbf4`;
  $(document).ready(function(e) {
    // Now Playing Movies AJAX call
    $.ajax({
      method: 'GET',
      url: `https://api.themoviedb.org/3/movie/now_playing?api_key=${key}&language=en-US&page=1`,
      success: function(response) {
        console.log(`Now Playing:`);
        console.log(response);
        response.results.map(child => {
          let movieId = child.id;
          let img = $(`<img class="now-playing-image" />`);
          let btn = $(
            `<input class="now-playing-button" type=submit value="Add" data-id="${movieId}"></input>`
          );
          let url = 'https://image.tmdb.org/t/p/w500' + child.poster_path;
          img.attr('src', url);
          $('.now-playing').append(img, btn);
          return movieId;
        });
      },
      error: function(error) {
        console.log(error);
      }
    });
  });

    $('.now-playing').on('click', '.now-playing-button', function(e) {
      console.log("You clicked on a movie")
      let clickedMovieId = e.target.getAttribute('data-id');
      $.ajax({
        method: 'POST',
        url: `http://localhost:8000/movie/${clickedMovieId}`,
        success: function(res) {
          console.log(`Clicked Movie ID was successfully added to DB: ${res}`);
        },
        error: function(error) {
          console.log(error);
        }
      });
    });
</script>

{% endblock %}
